matrix:
  include:
    - language: java
      jdk:
        - openjdk11
      branches:
        only:
          - master

      cache:
        directories:
          - '$HOME/.m2/repository'
          - '$HOME/.gradle'

      before_install:
        - cd backend/
        - chmod +x gradlew

      script: "./gradlew clean build"

      before_deploy:
        - zip -r Taskagile-Vue-Springboot *
        - mkdir -p deploy
        - mv Taskagile-Vue-Springboot.zip deploy/Taskagile-Vue-Springboot.zip
      deploy:
        - provider: s3
          access_key_id: $AWS_ACCESS_KEY
          secret_access_key: $AWS_SECRET_KEY
          bucket: taskagile-backend-build
          region: ap-northeast-2
          skip_cleanup: true
          acl: private
          local_dir: deploy
          wait-until-deployed: true

notifications:
  email:
    recipients:
      - donup088@gmail.com
